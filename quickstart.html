<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Quickstart &#8212; capnp 2.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css?v=279e0f84" />
    <script src="_static/documentation_options.js?v=20623aea"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Reference" href="capnp.html" />
    <link rel="prev" title="Installation" href="install.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="capnp.html" title="API Reference"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="install.html" title="Installation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">capnp 2.1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Quickstart</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="quickstart">
<span id="id1"></span><h1>Quickstart<a class="headerlink" href="#quickstart" title="Link to this heading">¶</a></h1>
<p>This assumes you already have the capnp library installed. If you don’t, please follow the instructions at <a class="reference internal" href="install.html#install"><span class="std std-ref">Installation</span></a> first.</p>
<p>In general, this library is a very light wrapping of the <a class="reference external" href="https://capnproto.org/cxx.html">Cap’n Proto C++ library</a>. You can refer to its docs for more advanced concepts, or just to get a basic idea of how the python library is structured.</p>
<section id="load-a-cap-n-proto-schema">
<h2>Load a Cap’n Proto Schema<a class="headerlink" href="#load-a-cap-n-proto-schema" title="Link to this heading">¶</a></h2>
<p>First you need to import the library:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">capnp</span>
</pre></div>
</div>
<p>Then you can load the Cap’n Proto schema with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">addressbook_capnp</span>
</pre></div>
</div>
<p>This will look all through all the directories in your sys.path/PYTHONPATH, and try to find a file of the form ‘addressbook.capnp’. If you want to disable the import hook magic that <cite>import capnp</cite> adds, and load manually, here’s how:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">capnp</span><span class="o">.</span><span class="n">remove_import_hook</span><span class="p">()</span>
<span class="n">addressbook_capnp</span> <span class="o">=</span> <span class="n">capnp</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;addressbook.capnp&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For future reference, here is the Cap’n Proto schema. Also available in the github repository under <a class="reference external" href="https://github.com/capnproto/pycapnp/tree/master/examples">examples/addressbook.capnp</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># addressbook.capnp</span>
<span class="o">@</span><span class="mh">0x934efea7f017fff0</span><span class="p">;</span>

<span class="n">const</span> <span class="n">qux</span> <span class="p">:</span><span class="n">UInt32</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>

<span class="n">struct</span> <span class="n">Person</span> <span class="p">{</span>
  <span class="nb">id</span> <span class="o">@</span><span class="mi">0</span> <span class="p">:</span><span class="n">UInt32</span><span class="p">;</span>
  <span class="n">name</span> <span class="o">@</span><span class="mi">1</span> <span class="p">:</span><span class="n">Text</span><span class="p">;</span>
  <span class="n">email</span> <span class="o">@</span><span class="mi">2</span> <span class="p">:</span><span class="n">Text</span><span class="p">;</span>
  <span class="n">phones</span> <span class="o">@</span><span class="mi">3</span> <span class="p">:</span><span class="n">List</span><span class="p">(</span><span class="n">PhoneNumber</span><span class="p">);</span>

  <span class="n">struct</span> <span class="n">PhoneNumber</span> <span class="p">{</span>
    <span class="n">number</span> <span class="o">@</span><span class="mi">0</span> <span class="p">:</span><span class="n">Text</span><span class="p">;</span>
    <span class="nb">type</span> <span class="o">@</span><span class="mi">1</span> <span class="p">:</span><span class="n">Type</span><span class="p">;</span>

    <span class="n">enum</span> <span class="n">Type</span> <span class="p">{</span>
      <span class="n">mobile</span> <span class="o">@</span><span class="mi">0</span><span class="p">;</span>
      <span class="n">home</span> <span class="o">@</span><span class="mi">1</span><span class="p">;</span>
      <span class="n">work</span> <span class="o">@</span><span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">employment</span> <span class="p">:</span><span class="n">union</span> <span class="p">{</span>
    <span class="n">unemployed</span> <span class="o">@</span><span class="mi">4</span> <span class="p">:</span><span class="n">Void</span><span class="p">;</span>
    <span class="n">employer</span> <span class="o">@</span><span class="mi">5</span> <span class="p">:</span><span class="n">Text</span><span class="p">;</span>
    <span class="n">school</span> <span class="o">@</span><span class="mi">6</span> <span class="p">:</span><span class="n">Text</span><span class="p">;</span>
    <span class="n">selfEmployed</span> <span class="o">@</span><span class="mi">7</span> <span class="p">:</span><span class="n">Void</span><span class="p">;</span>
    <span class="c1"># We assume that a person is only one of these.</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">struct</span> <span class="n">AddressBook</span> <span class="p">{</span>
  <span class="n">people</span> <span class="o">@</span><span class="mi">0</span> <span class="p">:</span><span class="n">List</span><span class="p">(</span><span class="n">Person</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="const-values">
<h3>Const values<a class="headerlink" href="#const-values" title="Link to this heading">¶</a></h3>
<p>Const values show up just as you’d expect under the loaded schema. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">addressbook_capnp</span><span class="o">.</span><span class="n">qux</span><span class="p">)</span>
<span class="c1"># 123</span>
</pre></div>
</div>
</section>
</section>
<section id="build-a-message">
<h2>Build a message<a class="headerlink" href="#build-a-message" title="Link to this heading">¶</a></h2>
<section id="initialize-a-new-cap-n-proto-object">
<h3>Initialize a New Cap’n Proto Object<a class="headerlink" href="#initialize-a-new-cap-n-proto-object" title="Link to this heading">¶</a></h3>
<p>Now that you’ve imported your schema, you need to allocate an actual struct from that schema. In this case, we will allocate an <cite>AddressBook</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">addresses</span> <span class="o">=</span> <span class="n">addressbook_capnp</span><span class="o">.</span><span class="n">AddressBook</span><span class="o">.</span><span class="n">new_message</span><span class="p">()</span>
</pre></div>
</div>
<p>Notice that we used <cite>addressbook_capnp</cite> from the previous section: <a class="reference internal" href="#load-a-cap-n-proto-schema">Load a Cap’n Proto Schema</a>.</p>
<p>Also as a shortcut, you can pass keyword arguments to the <cite>new_message</cite> function, and those fields will be set in the new message:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">person</span> <span class="o">=</span> <span class="n">addressbook_capnp</span><span class="o">.</span><span class="n">Person</span><span class="o">.</span><span class="n">new_message</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;alice&#39;</span><span class="p">)</span>
<span class="c1"># is equivalent to:</span>
<span class="n">person</span> <span class="o">=</span> <span class="n">addressbook_capnp</span><span class="o">.</span><span class="n">Person</span><span class="o">.</span><span class="n">new_message</span><span class="p">()</span>
<span class="n">person</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;alice&#39;</span>
</pre></div>
</div>
</section>
<section id="list">
<h3>List<a class="headerlink" href="#list" title="Link to this heading">¶</a></h3>
<p>Allocating a list inside of an object requires use of the <cite>init</cite> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">people</span> <span class="o">=</span> <span class="n">addresses</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>For now, let’s grab the first element out of this list and assign it to a variable named <cite>alice</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">alice</span> <span class="o">=</span> <span class="n">people</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is a very bad idea to call <cite>init</cite> more than once on a single field. Every call to <cite>init</cite> allocates new memory inside your Cap’n Proto message, and if you call it more than once, the previous memory is left as dead space in the message. See <a class="reference external" href="https://capnproto.org/cxx.html#tips-and-best-practices">Tips and Best Practices</a> for more details.</p>
</div>
</section>
<section id="primitive-types">
<h3>Primitive Types<a class="headerlink" href="#primitive-types" title="Link to this heading">¶</a></h3>
<p>For all primitive types, from the Cap’n Proto docs:</p>
<ul class="simple">
<li><p>Boolean: Bool</p></li>
<li><p>Integers: Int8, Int16, Int32, Int64</p></li>
<li><p>Unsigned integers: UInt8, UInt16, UInt32, UInt64</p></li>
<li><p>Floating-point: Float32, Float64</p></li>
<li><p>Blobs: Text, Data</p></li>
</ul>
<p>You can assign straight to the variable with the corresponding Python type. For Blobs, you use strings. Assignment happens just by using the <cite>.</cite> syntax on the object you contstructed above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">alice</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">123</span>
<span class="n">alice</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Alice&#39;</span>
<span class="n">alice</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="s1">&#39;alice@example.com&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Text fields will behave differently depending on your version of Python. In Python 2.x, Text fields will expect and return a <cite>bytes</cite> string, while in Python 3.x, they will expect and return a <cite>unicode</cite> string. Data fields will always a return <cite>bytes</cite> string.</p>
</div>
</section>
<section id="enums">
<h3>Enums<a class="headerlink" href="#enums" title="Link to this heading">¶</a></h3>
<p>First we’ll allocate a length one list of phonenumbers for <cite>alice</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">alicePhone</span> <span class="o">=</span> <span class="n">alice</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="s1">&#39;phones&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>Note that even though it was a length 1 list, it was still a list that was returned, and we extracted the first (and only) element with <cite>[0]</cite>.</p>
<p>Enums are treated like strings, and you assign to them like they were a Text field:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">alicePhone</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;mobile&#39;</span>
</pre></div>
</div>
<p>If you assign an invalid value to one, you will get a ValueError:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">alicePhone</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="n">KjException</span>                                <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">...</span>
<span class="ne">AttributeError</span><span class="p">:</span> <span class="n">capnp</span><span class="o">/</span><span class="n">schema</span><span class="o">.</span><span class="n">c</span><span class="o">++</span><span class="p">:</span><span class="mi">566</span><span class="p">:</span> <span class="n">failed</span><span class="p">:</span> <span class="n">enum</span> <span class="n">has</span> <span class="n">no</span> <span class="n">such</span> <span class="n">enumerant</span><span class="p">;</span> <span class="n">name</span> <span class="o">=</span> <span class="n">foo</span>
</pre></div>
</div>
</section>
<section id="unions">
<h3>Unions<a class="headerlink" href="#unions" title="Link to this heading">¶</a></h3>
<p>For the most part, you just treat them like structs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">alice</span><span class="o">.</span><span class="n">employment</span><span class="o">.</span><span class="n">school</span> <span class="o">=</span> <span class="s2">&quot;MIT&quot;</span>
</pre></div>
</div>
<p>Now the <cite>school</cite> field is the active part of the union, and we’ve assigned <cite>‘MIT’</cite> to it. You can query which field is set in a union with <cite>which()</cite>, shown in <a class="reference internal" href="#reading-unions">Reading Unions</a></p>
<p>Also, one weird case is for Void types in Unions (and in general, but Void is really only used in Unions). For these, you will have to assign <cite>None</cite> to them:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bob</span><span class="o">.</span><span class="n">employment</span><span class="o">.</span><span class="n">unemployed</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>One caveat for unions is having structs as union members. Let us assume <cite>employment.school</cite> was actually a struct with a field of type <cite>Text</cite> called <cite>name</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">alice</span><span class="o">.</span><span class="n">employment</span><span class="o">.</span><span class="n">school</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;MIT&quot;</span>
<span class="c1"># Raises a KjException</span>
</pre></div>
</div>
<p>The problem is that a struct within a union isn’t initialized automatically. You have to do the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TODO</span> <span class="n">Broken</span>
<span class="n">school</span> <span class="o">=</span> <span class="n">alice</span><span class="o">.</span><span class="n">employment</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="s1">&#39;school&#39;</span><span class="p">)</span>
<span class="n">school</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;MIT&quot;</span>
</pre></div>
</div>
<p>Note that this is similar to <cite>init</cite> for lists, but you don’t pass a size. Requiring the <cite>init</cite> makes it more clear that a memory allocation is occurring, and will hopefully make you mindful that you shouldn’t set more than 1 field inside of a union, else you risk a memory leak</p>
</div>
</section>
<section id="writing-to-a-file">
<h3>Writing to a File<a class="headerlink" href="#writing-to-a-file" title="Link to this heading">¶</a></h3>
<p>Once you’re done assigning to all the fields in a message, you can write it to a file like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;example.bin&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">addresses</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<p>There is also a <cite>write_packed</cite> function, that writes out the message more space-efficientally. If you use write_packed, make sure to use read_packed when reading the message.</p>
</section>
<section id="writing-to-a-socket">
<h3>Writing to a socket<a class="headerlink" href="#writing-to-a-socket" title="Link to this heading">¶</a></h3>
<p>Alternatively, you can write to a socket. This is useful if you want to send the message over the network or to another process.
A full example of this is available on GitHub <a class="reference external" href="https://github.com/capnproto/pycapnp/blob/master/examples/async_socket_message_client.py">examples/async_socket_message_client.py</a>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Writing to a socket is implemented using asyncio and requires a running event loop both for the python part (asyncio) and the C++ part (KJ). See <a class="reference internal" href="#id3"><span class="std std-ref">RPC</span></a> for more information.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stream</span> <span class="o">=</span> <span class="k">await</span> <span class="n">capnp</span><span class="o">.</span><span class="n">AsyncIoStream</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6000</span><span class="p">)</span>
<span class="k">await</span> <span class="n">addresses</span><span class="o">.</span><span class="n">write_async</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="read-a-message">
<h2>Read a message<a class="headerlink" href="#read-a-message" title="Link to this heading">¶</a></h2>
<section id="reading-from-a-file">
<h3>Reading from a file<a class="headerlink" href="#reading-from-a-file" title="Link to this heading">¶</a></h3>
<p>Much like before, you will have to de-serialize the message from a file descriptor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;example.bin&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">addressbook_capnp</span><span class="o">.</span><span class="n">AddressBook</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that this very much needs to match the type you wrote out. In general, you will always be sending the same message types out over a given channel or you should wrap all your types in an unnamed union. Unnamed unions are defined in the .capnp file like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="n">Message</span> <span class="p">{</span>
    <span class="n">union</span> <span class="p">{</span>
      <span class="n">person</span> <span class="o">@</span><span class="mi">0</span> <span class="p">:</span><span class="n">Person</span><span class="p">;</span>
      <span class="n">addressbook</span> <span class="o">@</span><span class="mi">1</span> <span class="p">:</span><span class="n">AddressBook</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="reading-from-a-socket">
<h3>Reading from a socket<a class="headerlink" href="#reading-from-a-socket" title="Link to this heading">¶</a></h3>
<p>The same as for writing, you can read from a socket. This is useful if you want to receive the message over the network or from another process.
A full example of this is available on GitHub <a class="reference external" href="https://github.com/capnproto/pycapnp/blob/master/examples/async_socket_message_client.py">examples/async_socket_message_client.py</a>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Reading from a socket is implemented using asyncio and requires a running event loop both for the python part (asyncio) and the C++ part (KJ). See <a class="reference internal" href="#id3"><span class="std std-ref">RPC</span></a> for more information.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stream</span> <span class="o">=</span> <span class="k">await</span> <span class="n">capnp</span><span class="o">.</span><span class="n">AsyncIoStream</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6000</span><span class="p">)</span>
<span class="n">message</span> <span class="o">=</span> <span class="k">await</span> <span class="n">addressbook_capnp</span><span class="o">.</span><span class="n">AddressBook</span><span class="o">.</span><span class="n">read_async</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="reading-fields">
<h3>Reading Fields<a class="headerlink" href="#reading-fields" title="Link to this heading">¶</a></h3>
<p>Fields are very easy to read. You just use the <cite>.</cite> syntax as before. Lists behave just like normal Python lists:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">addresses</span><span class="o">.</span><span class="n">people</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">person</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">phone</span> <span class="ow">in</span> <span class="n">person</span><span class="o">.</span><span class="n">phones</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">phone</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">phone</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="reading-unions">
<h3>Reading Unions<a class="headerlink" href="#reading-unions" title="Link to this heading">¶</a></h3>
<p>The only tricky one is unions, where you need to call <cite>.which()</cite> to determine the union type. The <cite>.which()</cite> call returns an enum, ie. a string, corresponding to the field name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">which</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">employment</span><span class="o">.</span><span class="n">which</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">which</span><span class="p">)</span>

<span class="k">if</span> <span class="n">which</span> <span class="o">==</span> <span class="s1">&#39;unemployed&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;unemployed&#39;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">which</span> <span class="o">==</span> <span class="s1">&#39;employer&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;employer:&#39;</span><span class="p">,</span> <span class="n">person</span><span class="o">.</span><span class="n">employment</span><span class="o">.</span><span class="n">employer</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">which</span> <span class="o">==</span> <span class="s1">&#39;school&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;student at:&#39;</span><span class="p">,</span> <span class="n">person</span><span class="o">.</span><span class="n">employment</span><span class="o">.</span><span class="n">school</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">which</span> <span class="o">==</span> <span class="s1">&#39;selfEmployed&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;self employed&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="serializing-deserializing">
<h2>Serializing/Deserializing<a class="headerlink" href="#serializing-deserializing" title="Link to this heading">¶</a></h2>
<section id="files">
<h3>Files<a class="headerlink" href="#files" title="Link to this heading">¶</a></h3>
<p>As shown in the examples above, there is file serialization with <cite>write()</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">addresses</span> <span class="o">=</span> <span class="n">addressbook_capnp</span><span class="o">.</span><span class="n">AddressBook</span><span class="o">.</span><span class="n">new_message</span><span class="p">()</span>
<span class="o">...</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;example.bin&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">addresses</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<p>And similarly for reading:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;example.bin&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">addressbook_capnp</span><span class="o">.</span><span class="n">AddressBook</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<p>There are packed versions as well:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;example.bin&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">addresses</span><span class="o">.</span><span class="n">write_packed</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="o">...</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;example.bin&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">addressbook_capnp</span><span class="o">.</span><span class="n">AddressBook</span><span class="o">.</span><span class="n">read_packed</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="multi-message-files">
<h3>Multi-message files<a class="headerlink" href="#multi-message-files" title="Link to this heading">¶</a></h3>
<p>The above methods only guaranteed to work if your file contains a single message. If you have more than 1 message serialized sequentially in your file, then you need to use these convenience functions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">addresses</span> <span class="o">=</span> <span class="n">addressbook_capnp</span><span class="o">.</span><span class="n">AddressBook</span><span class="o">.</span><span class="n">new_message</span><span class="p">()</span>
<span class="o">...</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;example.bin&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">addresses</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">addresses</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">addresses</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="c1"># write 3 messages</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;example.bin&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">addresses</span> <span class="ow">in</span> <span class="n">addressbook_capnp</span><span class="o">.</span><span class="n">AddressBook</span><span class="o">.</span><span class="n">read_multiple</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">addresses</span><span class="p">)</span>
</pre></div>
</div>
<p>There is also a packed version:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">addresses</span> <span class="ow">in</span> <span class="n">addressbook_capnp</span><span class="o">.</span><span class="n">AddressBook</span><span class="o">.</span><span class="n">read_multiple_packed</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="nb">print</span> <span class="n">addresses</span>
</pre></div>
</div>
</section>
<section id="dictionaries">
<h3>Dictionaries<a class="headerlink" href="#dictionaries" title="Link to this heading">¶</a></h3>
<p>There is a convenience method for converting Cap’n Proto messages to a dictionary. This works for both Builder and Reader type messages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">alice</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</pre></div>
</div>
<p>For the reverse, all you have to do is pass keyword arguments to the new_message constructor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span> <span class="p">:</span> <span class="s1">&#39;alice&#39;</span><span class="p">}</span>
<span class="n">alice</span> <span class="o">=</span> <span class="n">addressbook_capnp</span><span class="o">.</span><span class="n">Person</span><span class="o">.</span><span class="n">new_message</span><span class="p">(</span><span class="o">**</span><span class="n">my_dict</span><span class="p">)</span>
<span class="c1"># equivalent to: alice = addressbook_capnp.Person.new_message(name=&#39;alice&#39;)</span>
</pre></div>
</div>
<p>It’s also worth noting, you can use python lists/dictionaries interchangably with their Cap’n Proto equivalent types:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">book</span> <span class="o">=</span> <span class="n">addressbook_capnp</span><span class="o">.</span><span class="n">AddressBook</span><span class="o">.</span><span class="n">new_message</span><span class="p">(</span><span class="n">people</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Alice&#39;</span><span class="p">}])</span>
<span class="o">...</span>
<span class="n">book</span> <span class="o">=</span> <span class="n">addressbook_capnp</span><span class="o">.</span><span class="n">AddressBook</span><span class="o">.</span><span class="n">new_message</span><span class="p">()</span>
<span class="n">book</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">book</span><span class="o">.</span><span class="n">people</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Bob&#39;</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="byte-strings-buffers">
<h3>Byte Strings/Buffers<a class="headerlink" href="#byte-strings-buffers" title="Link to this heading">¶</a></h3>
<p>There is serialization to a byte string available:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">encoded_message</span> <span class="o">=</span> <span class="n">alice</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">()</span>
</pre></div>
</div>
<p>And a corresponding from_bytes function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">addressbook_capnp</span><span class="o">.</span><span class="n">Person</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">encoded_message</span><span class="p">)</span> <span class="k">as</span> <span class="n">alice</span><span class="p">:</span>
    <span class="c1"># something with alice</span>
</pre></div>
</div>
<p>There are also packed versions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">alice2</span> <span class="o">=</span> <span class="n">addressbook_capnp</span><span class="o">.</span><span class="n">Person</span><span class="o">.</span><span class="n">from_bytes_packed</span><span class="p">(</span><span class="n">alice</span><span class="o">.</span><span class="n">to_bytes_packed</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="byte-segments">
<h3>Byte Segments<a class="headerlink" href="#byte-segments" title="Link to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This feature is not supported in PyPy at the moment, pending investigation.</p>
</div>
<p>Cap’n Proto supports a serialization mode which minimizes object copies. In the C++ interface, <code class="docutils literal notranslate"><span class="pre">capnp::MessageBuilder::getSegmentsForOutput()</span></code> returns an array of pointers to segments of the message’s content without copying. <code class="docutils literal notranslate"><span class="pre">capnp::SegmentArrayMessageReader</span></code> performs the reverse operation, i.e., takes an array of pointers to segments and uses the underlying data, again without copying. This produces a different wire serialization format from <code class="docutils literal notranslate"><span class="pre">to_bytes()</span></code> serialization, which uses <code class="docutils literal notranslate"><span class="pre">capnp::messageToFlatArray()</span></code> and <code class="docutils literal notranslate"><span class="pre">capnp::FlatArrayMessageReader</span></code> (both of which use segments internally, but write them in an incompatible way).</p>
<p>For compatibility on the Python side, use the <code class="docutils literal notranslate"><span class="pre">to_segments()</span></code> and <code class="docutils literal notranslate"><span class="pre">from_segments()</span></code> functions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">segments</span> <span class="o">=</span> <span class="n">alice</span><span class="o">.</span><span class="n">to_segments</span><span class="p">()</span>
</pre></div>
</div>
<p>This returns a list of segments, each a byte buffer. Each segment can be, e.g., turned into a ZeroMQ message frame. The list of segments can also be turned back into an object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">alice</span> <span class="o">=</span> <span class="n">addressbook_capnp</span><span class="o">.</span><span class="n">Person</span><span class="o">.</span><span class="n">from_segments</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>
</pre></div>
</div>
<p>For more information, please refer to the following links:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://stackoverflow.com/questions/28149139/serializing-mutable-state-and-sending-it-asynchronously-over-the-network-with-ne/28156323#28156323">Advice on minimizing copies from Cap’n Proto</a> (from the author of Cap’n Proto)</p></li>
<li><p><a class="reference external" href="https://stackoverflow.com/questions/32041315/how-to-send-capn-proto-message-over-zmq/32042234#32042234">Advice on using Cap’n Proto over ZeroMQ</a> (from the author of Cap’n Proto)</p></li>
<li><p><a class="reference external" href="https://groups.google.com/forum/#!topic/capnproto/ClDjGbO7egA">Discussion about sending and reassembling Cap’n Proto message segments in C++</a> (from the Cap’n Proto mailing list; includes sample code)</p></li>
</ul>
</section>
</section>
<section id="rpc">
<h2>RPC<a class="headerlink" href="#rpc" title="Link to this heading">¶</a></h2>
<p>Cap’n Proto has a rich RPC protocol. You should read the <a class="reference external" href="https://capnproto.org/rpc.html">RPC specification</a> as well as the <a class="reference external" href="http://kentonv.github.io/capnproto/cxxrpc.html">C++ RPC documentation</a> before using pycapnp’s RPC features. As with the serialization part of this library, the RPC component tries to be a very thin wrapper on top of the C++ API.</p>
<p>The examples below will be using <a class="reference external" href="https://github.com/capnproto/pycapnp/blob/master/examples/calculator.capnp">calculator.capnp</a>. Please refer to it to understand the interfaces that will be used.</p>
<p>Asyncio support was added to pycapnp in v1.0.0. Since v2.0.0, the usage of asyncio is mandatory for all RPC calls. This guarantees a more robust and flexible RPC implementation.</p>
<section id="kj-event-loop">
<h3>KJ Event Loop<a class="headerlink" href="#kj-event-loop" title="Link to this heading">¶</a></h3>
<p id="id3">Cap’n Proto uses the KJ event loop for its RPC implementation. Pycapnp handles all the required mapping between the asyncio event loop and the KJ event loop.
To ensure proper creation, usage, and cleanup of the KJ event loop, a context manager called <a class="reference internal" href="capnp.html#capnp.kj_loop" title="capnp.kj_loop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">capnp.kj_loop()</span></code></a> is exposed by pycapnp . All RPC calls must be made within this context:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">capnp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">capnp</span><span class="o">.</span><span class="n">kj_loop</span><span class="p">():</span>
        <span class="c1"># RPC calls here</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p>To simplify the usage, the helper function:py:meth:<cite>capnp.run</cite> can execute a asyncio coroutine within the <a class="reference internal" href="capnp.html#capnp.kj_loop" title="capnp.kj_loop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">capnp.kj_loop()</span></code></a> context manager:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">capnp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="c1"># RPC calls here</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">capnp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">()))</span>
</pre></div>
</div>
</section>
<section id="client">
<h3>Client<a class="headerlink" href="#client" title="Link to this heading">¶</a></h3>
<p id="rpc-asyncio-client">Thanks to the integration into the asyncio library, most of the boiler plate code is handled by pycapnp directly. The only thing that needs to be done is to create a client object and bootstrap the server capability.</p>
<section id="starting-a-client">
<h4>Starting a Client<a class="headerlink" href="#starting-a-client" title="Link to this heading">¶</a></h4>
<p>The first step is to open a socket to the server. For now this needs to be done
through <a class="reference internal" href="capnp.html#capnp.lib.capnp._AsyncIoStream.create_connection" title="capnp.lib.capnp._AsyncIoStream.create_connection"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_connection()</span></code></a>. A thin wrapper around <code class="xref py py-meth docutils literal notranslate"><span class="pre">asyncio.get_running_loop().create_connection()</span></code>
that adds all required Protocol handling:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span>
    <span class="n">port</span> <span class="o">=</span> <span class="s1">&#39;6000&#39;</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="k">await</span> <span class="n">capnp</span><span class="o">.</span><span class="n">AsyncIoStream</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">capnp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">()))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="capnp.html#capnp.lib.capnp._AsyncIoStream.create_connection" title="capnp.lib.capnp._AsyncIoStream.create_connection"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_connection()</span></code></a> forwards all calls to the underlying asyncio create_connection function.</p>
</div>
<p>In the next step, this created connection can be passed to <a class="reference internal" href="capnp.html#capnp.TwoPartyClient" title="capnp.TwoPartyClient"><code class="xref py py-meth docutils literal notranslate"><span class="pre">capnp.TwoPartyClient()</span></code></a> to create the client object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span>
    <span class="n">port</span> <span class="o">=</span> <span class="s1">&#39;6000&#39;</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="k">await</span> <span class="n">capnp</span><span class="o">.</span><span class="n">AsyncIoStream</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">capnp</span><span class="o">.</span><span class="n">TwoPartyClient</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>
    <span class="c1">## Bootstrap Here ##</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">capnp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">()))</span>
</pre></div>
</div>
<section id="ssl-tls-client">
<h5>SSL/TLS Client<a class="headerlink" href="#ssl-tls-client" title="Link to this heading">¶</a></h5>
<p>SSL/TLS setup effectively wraps the socket transport. You’ll need an SSL certificate, for this example, we’ll use a self-signed certificate. Since we wrap around the asyncio connection interface, the SSL/TLS setup is done through the <code class="xref py py-obj docutils literal notranslate"><span class="pre">ssl`</span></code> parameter of <a class="reference internal" href="capnp.html#capnp.lib.capnp._AsyncIoStream.create_connection" title="capnp.lib.capnp._AsyncIoStream.create_connection"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_connection()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span>
    <span class="n">port</span> <span class="o">=</span> <span class="s1">&#39;6000&#39;</span>
    <span class="c1"># Setup SSL context</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">Purpose</span><span class="o">.</span><span class="n">SERVER_AUTH</span><span class="p">,</span> <span class="n">cafile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">this_dir</span><span class="p">,</span> <span class="s2">&quot;selfsigned.cert&quot;</span><span class="p">))</span>

    <span class="n">connection</span> <span class="o">=</span> <span class="k">await</span> <span class="n">capnp</span><span class="o">.</span><span class="n">AsyncIoStream</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">ssl</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">)</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">capnp</span><span class="o">.</span><span class="n">TwoPartyClient</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>
    <span class="c1">## Bootstrap Here ##</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">capnp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">()))</span>
</pre></div>
</div>
<p>Due to a <a class="reference external" href="https://bugs.python.org/issue36709">bug</a> in Python 3.8 asyncio client needs to be initialized in a slightly different way:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
    <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">capnp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">(</span><span class="n">parse_args</span><span class="p">()</span><span class="o">.</span><span class="n">host</span><span class="p">)))</span>
</pre></div>
</div>
</section>
</section>
<section id="bootstrap">
<h4>Bootstrap<a class="headerlink" href="#bootstrap" title="Link to this heading">¶</a></h4>
<p>Before calling any methods you’ll need to bootstrap the Calculator interface:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">calculator</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">bootstrap</span><span class="p">()</span><span class="o">.</span><span class="n">cast_as</span><span class="p">(</span><span class="n">calculator_capnp</span><span class="o">.</span><span class="n">Calculator</span><span class="p">)</span>
</pre></div>
</div>
<p>There’s two things worth noting here. First, we are asking for the server capability. Secondly, you see that we are casting the capability that we receive. This is because capabilities are intrinsically dynamic, and they hold no run time type information, so we need to pick what interface to interpret them as.</p>
</section>
<section id="calling-methods">
<h4>Calling methods<a class="headerlink" href="#calling-methods" title="Link to this heading">¶</a></h4>
<p>There are 2 ways to call RPC methods. First the more verbose <cite>request</cite> syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">request</span> <span class="o">=</span> <span class="n">calculator</span><span class="o">.</span><span class="n">evaluate_request</span><span class="p">()</span>
<span class="n">request</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">literal</span> <span class="o">=</span> <span class="mi">123</span>
<span class="n">eval_promise</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">send</span><span class="p">()</span>
</pre></div>
</div>
<p>This creates a request for the method named ‘evaluate’, sets <cite>expression.literal</cite> in that call’s parameters to 123, and then sends the request and returns a promise (all non-blocking).</p>
<p>The shorter syntax for calling methods is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">eval_promise</span> <span class="o">=</span> <span class="n">calculator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">({</span><span class="s2">&quot;literal&quot;</span><span class="p">:</span> <span class="mi">123</span><span class="p">})</span>
</pre></div>
</div>
<p>The major shortcoming with this method is that expressing complex fields with many nested sub-structs can become very tedious.</p>
<p>The returned promise can be handled like any other asyncio promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">eval_promise</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="pipelining">
<h4>Pipelining<a class="headerlink" href="#pipelining" title="Link to this heading">¶</a></h4>
<p>If a method returns values that are themselves capabilites, then you can access these fields before awaiting the promise. Doing this is called pipelining, and it allows Cap’n Proto to chain the calls without a round-trip occurring to the server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># evaluate returns `value` which is itself an interface.</span>
<span class="c1"># You can call a new method on `value` without having to call wait first</span>
<span class="n">read_promise</span> <span class="o">=</span> <span class="n">eval_promise</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">read_result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">read_promise</span> <span class="c1"># only 1 await call</span>
</pre></div>
</div>
</section>
</section>
<section id="server">
<h3>Server<a class="headerlink" href="#server" title="Link to this heading">¶</a></h3>
<section id="starting-a-server">
<h4>Starting a Server<a class="headerlink" href="#starting-a-server" title="Link to this heading">¶</a></h4>
<p>Like the client, the server uses an asyncio server that can be created with <a class="reference internal" href="capnp.html#capnp.lib.capnp._AsyncIoStream.create_server" title="capnp.lib.capnp._AsyncIoStream.create_server"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_server()</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="capnp.html#capnp.lib.capnp._AsyncIoStream.create_server" title="capnp.lib.capnp._AsyncIoStream.create_server"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_server()</span></code></a>, similar to <a class="reference internal" href="capnp.html#capnp.lib.capnp._AsyncIoStream.create_connection" title="capnp.lib.capnp._AsyncIoStream.create_connection"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_connection()</span></code></a>, forwards all arguments to the underlying asyncio create_connection function (with the exception of the first argument).</p>
</div>
<p>The first argument to <a class="reference internal" href="capnp.html#capnp.lib.capnp._AsyncIoStream.create_server" title="capnp.lib.capnp._AsyncIoStream.create_server"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_server()</span></code></a> must be a callback
used by the pycapnp protocol implementation. The <code class="xref py py-obj docutils literal notranslate"><span class="pre">callback</span></code> parameter will be called
whenever a new connection is made. It receives a py:obj:<cite>AsyncIoStream</cite> instance as its
only argument. If the result of py:obj:<cite>callback</cite> is a coroutine, it will be scheduled as a
task. At minimum, the callback should create a <a class="reference internal" href="capnp.html#capnp.TwoPartyServer" title="capnp.TwoPartyServer"><code class="xref py py-class docutils literal notranslate"><span class="pre">capnp.TwoPartyServer</span></code></a> for the
passed stream. <a class="reference internal" href="capnp.html#capnp.TwoPartyServer" title="capnp.TwoPartyServer"><code class="xref py py-class docutils literal notranslate"><span class="pre">capnp.TwoPartyServer</span></code></a> also exposes a
<a class="reference internal" href="capnp.html#capnp.TwoPartyServer.on_disconnect" title="capnp.TwoPartyServer.on_disconnect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_disconnect()</span></code></a> function, which can be used as a task to handle
the lifetime properly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">new_connection</span><span class="p">(</span><span class="n">stream</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">capnp</span><span class="o">.</span><span class="n">TwoPartyServer</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">bootstrap</span><span class="o">=</span><span class="n">CalculatorImpl</span><span class="p">())</span><span class="o">.</span><span class="n">on_disconnect</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span>
    <span class="n">port</span> <span class="o">=</span> <span class="s1">&#39;6000&#39;</span>
    <span class="n">server</span> <span class="o">=</span> <span class="k">await</span> <span class="n">capnp</span><span class="o">.</span><span class="n">AsyncIoStream</span><span class="o">.</span><span class="n">create_server</span><span class="p">(</span><span class="n">new_connection</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">server</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">capnp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">()))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>On systems that have both IPv4 and IPv6 addresses, IPv6 is often resolved first and needs to be handled separately. If you’re certain IPv6 won’t be used, you can remove it (you should also avoid localhost, and stick to something like 127.0.0.1). If you’re broadcasting in general, you’ll probably want to use <cite>0.0.0.0</cite> (IPv4) or <cite>::/0</cite> (IPv6).</p>
</div>
<section id="ssl-tls-server">
<h5>SSL/TLS Server<a class="headerlink" href="#ssl-tls-server" title="Link to this heading">¶</a></h5>
<p>Adding SSL/TLS support for a pycapnp asyncio server is fairly straight-forward. Just create an SSL context before starting the asyncio server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">new_connection</span><span class="p">(</span><span class="n">stream</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">capnp</span><span class="o">.</span><span class="n">TwoPartyServer</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">bootstrap</span><span class="o">=</span><span class="n">CalculatorImpl</span><span class="p">())</span><span class="o">.</span><span class="n">on_disconnect</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span>
    <span class="n">port</span> <span class="o">=</span> <span class="s1">&#39;6000&#39;</span>

    <span class="c1"># Setup SSL context</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">Purpose</span><span class="o">.</span><span class="n">CLIENT_AUTH</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">load_cert_chain</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">this_dir</span><span class="p">,</span> <span class="s2">&quot;selfsigned.cert&quot;</span><span class="p">),</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">this_dir</span><span class="p">,</span> <span class="s2">&quot;selfsigned.key&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">server</span> <span class="o">=</span> <span class="k">await</span> <span class="n">capnp</span><span class="o">.</span><span class="n">AsyncIoStream</span><span class="o">.</span><span class="n">create_server</span><span class="p">(</span>
        <span class="n">new_connection</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">ssl</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span>
    <span class="p">)</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">server</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">capnp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">()))</span>
</pre></div>
</div>
</section>
</section>
<section id="implementing-a-server">
<h4>Implementing a Server<a class="headerlink" href="#implementing-a-server" title="Link to this heading">¶</a></h4>
<p>Here’s a part of how you would implement a Calculator server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">CalculatorImpl</span><span class="p">(</span><span class="n">calculator_capnp</span><span class="o">.</span><span class="n">Calculator</span><span class="o">.</span><span class="n">Server</span><span class="p">):</span>

    <span class="s2">&quot;Implementation of the Calculator Cap&#39;n Proto interface.&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">_context</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">evaluate_impl</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">_context</span><span class="o">.</span><span class="n">results</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">ValueImpl</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">defFunction_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">params</span>
        <span class="n">context</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">FunctionImpl</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">paramCount</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getOperator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">OperatorImpl</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
</pre></div>
</div>
<p>Some major things worth noting.</p>
<ul>
<li><p>You must inherit from <cite>your_module_capnp.YourInterface.Server</cite>, but don’t worry about calling __super__ in your __init__</p></li>
<li><p>Method names of your class must either match the interface exactly, or have ‘_context’ appended to it</p></li>
<li><p>If your method name is exactly the same as the interface, then you will be passed all the arguments from the interface as keyword arguments, so your argument names must match the interface spec exactly. You will also receive a <cite>_context</cite> parameter which is equivalent to the C++ API’s Context. I highly recommend having <cite>**kwargs</cite> as well, so that even if your interface spec is upgraded and arguments were added, your server will still operate fine.</p></li>
<li><p>Returns work with a bit of magic as well. If you return a promise, then it will be handled the same as if you returned a promise from a server method in the C++ API. Otherwise, your return statement will be filled into the results struct following the ordering in your spec, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># capability.capnp file</span>
<span class="n">interface</span> <span class="n">TestInterface</span> <span class="p">{</span>
  <span class="n">foo</span> <span class="o">@</span><span class="mi">0</span> <span class="p">(</span><span class="n">i</span> <span class="p">:</span><span class="n">UInt32</span><span class="p">,</span> <span class="n">j</span> <span class="p">:</span><span class="n">Bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Text</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span><span class="n">UInt32</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1"># python code</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TestInterface</span><span class="p">(</span><span class="n">capability_capnp</span><span class="o">.</span><span class="n">TestInterface</span><span class="o">.</span><span class="n">Server</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">i</span>
</pre></div>
</div>
</li>
<li><p>If your method ends in _context, then you will only be passed a context parameter. You will have to access params and set results yourself manually. Returning promises still works as above, but you can’t return anything else from a method.</p></li>
</ul>
</section>
</section>
</section>
<section id="full-examples">
<h2>Full Examples<a class="headerlink" href="#full-examples" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://github.com/capnproto/pycapnp/blob/master/examples">Full examples</a> are available on github. There is also an example of a very simplistic RPC available in <a class="reference external" href="https://github.com/capnproto/pycapnp/blob/master/test/test_rpc.py">test_rpc.py</a>.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#load-a-cap-n-proto-schema">Load a Cap’n Proto Schema</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#const-values">Const values</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#build-a-message">Build a message</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#initialize-a-new-cap-n-proto-object">Initialize a New Cap’n Proto Object</a></li>
<li class="toctree-l3"><a class="reference internal" href="#list">List</a></li>
<li class="toctree-l3"><a class="reference internal" href="#primitive-types">Primitive Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enums">Enums</a></li>
<li class="toctree-l3"><a class="reference internal" href="#unions">Unions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#writing-to-a-file">Writing to a File</a></li>
<li class="toctree-l3"><a class="reference internal" href="#writing-to-a-socket">Writing to a socket</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#read-a-message">Read a message</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#reading-from-a-file">Reading from a file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reading-from-a-socket">Reading from a socket</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reading-fields">Reading Fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reading-unions">Reading Unions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#serializing-deserializing">Serializing/Deserializing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#files">Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multi-message-files">Multi-message files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dictionaries">Dictionaries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#byte-strings-buffers">Byte Strings/Buffers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#byte-segments">Byte Segments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#rpc">RPC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#kj-event-loop">KJ Event Loop</a></li>
<li class="toctree-l3"><a class="reference internal" href="#client">Client</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#starting-a-client">Starting a Client</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bootstrap">Bootstrap</a></li>
<li class="toctree-l4"><a class="reference internal" href="#calling-methods">Calling methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pipelining">Pipelining</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#server">Server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#starting-a-server">Starting a Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#implementing-a-server">Implementing a Server</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#full-examples">Full Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="capnp.html">API Reference</a></li>
</ul>

  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="install.html"
                          title="previous chapter">Installation</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="capnp.html"
                          title="next chapter">API Reference</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/quickstart.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="capnp.html" title="API Reference"
             >next</a> |</li>
        <li class="right" >
          <a href="install.html" title="Installation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">capnp 2.1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Quickstart</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2013-2019 (Jason Paryani), 2019-2020 (Jacob Alexander).
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    </div>
  </body>
</html>